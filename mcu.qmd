---
title: "MCU Design"
description: "STM32L432KC responsibilities, inputs, timing, and waveform generation."
---

## MCU Overview (STM32L432KC)

The MCU reads three inputs to determine the two output frequencies:

1. Keypad (8 keys) via GPIO scanning
2. Gyroscope via SPI (8-bit angular acceleration/velocity data)
3. Knobs via on-chip ADC (continuous control for pitch/modulation)

Based on these inputs, the MCU computes two desired frequencies to be played on two speakers. The MCU generates corresponding digital waveforms and communicates with the FPGA over SPI for filtering and additional DSP.

### Responsibilities

- Input acquisition: GPIO keypad scan, SPI gyro reads, ADC sampling (knobs)
- Frequency mapping: Key-to-frequency and angular velocity-to-frequency conversions
- Waveform generation: Digital oscillators at target frequencies
- Streaming/control to FPGA via SPI
- Receiving filtered waveforms/status from FPGA

### Timing Strategy

A pin on the MCU is connected to a timer associated with one of the two target frequencies.
 The timer is toggled at a rate fast enough that the resulting composite output sounds like the sum of the two notes, while remaining slow 
 enough for the FPGA to sample and filter both components effectively. This balances perceptual audio quality with FPGA processing constraints.

### Interfaces

- SPI: Gyroscope reads, waveform/control data exchange with FPGA
- GPIO: 8-key keypad matrix
- ADC: Knob voltages (modulation, pitch bend, filter control, etc.)


